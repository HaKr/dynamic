<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Dynamic App</title>
		<link rel=stylesheet media=all href=dynamic-app.css>
		<script src=js/dynamic.js></script>
	</head>

	<body class=dynamic-person>

		<!-- debugging info -->
		<div class=meta>
			<label>Templates:    	{{debug.template_count}}.</label>
			<label>Placeholders:    {{debug.placeholder_count}}.</label>
			<label>Instances:    	{{debug.instance_count}}.</label>
			<label>Observers:     	{{debug.observer_count}}.</label>
		</div>

		<!-- have some refrence values ready -->
		<input type=hidden name="fte.fulltime= 40 / 40">
		<input type=hidden name="fte.36= 36 / 40">
		<input type=hidden name="fte.32= 32 / 40">
		<input type=hidden name="fte.24= 24 / 40">
		<input type=hidden name="fte.20= 20 / 40">
		<input type=hidden name="fte.16= 16 / 40">

		<!-- Template that will be used in the table -->
		<select class="dynamic-template fte-select">
			<option value={{fte.fulltime}}>Fulltime</option>
			<option value={{fte.36}}>36 uur</option>
			<option value={{fte.32}}>32 uur</option>
			<option value={{fte.24}}>24 uur</option>
			<option value={{fte.20}}>20 uur</option>
			<option value={{fte.16}}>16 uur</option>

			<!-- alternative way to specify a fixed value  -->
			<option value='{{fte.8= 8 / 40}}'>8 uur</option>
		</select>

		<div class=selection>

			<!-- Simulator buttons, one simulates the GET of person data, the second logs that data to the console -->
			<div>
				<span class=reallabel>Actions:</span>
					<button id=set-button>Simulate Get Person list call</button>
					<button id=show-button>Show person in console</button>
				
			</div>	

			<label>Show info for:
				<select id=person-select name=persons.$selected class="dynamic-template person-select" data-dynamic-template-for="persons">
					<option disabled>Choose a person</option>

					<option value={{.$reference}} class="dynamic-template person-select-option" data-dynamic-template-for-each="persons">
						{{.first-name}} {{.last-name}}
					</option>

				</select>
			</label>
		</div>

		<!-- company info; company address will be added later in this HTML -->
		<div class="dynamic-template company" data-dynamic-template-for="persons.@.company">
			<h2>{{.name}}</h2>
		</div>

		<form id="build_input" method="post" action="/api/build-input" class="dynamic-template person-record-input" data-dynamic-template-for="persons.@">
			<label>First name: 
				<input name=".first-name">
			</label>
			<label>Last name: 
			<input name=.last-name></label>
		</form>

		<p>Hello {{persons.@.description}}.</p>

		<!--
			Generic address template 
				Only when the street is given, street and number are added
				Note that when postal is missing, no blanks are left of city
		-->
		<address class="dynamic-template address">
			<label class="dynamic-template address-street" data-dynamic-template-for=".street">
					Adress:      {{..street}} {{..number}}.</label>
			<label>	City:        {{.postal}}  {{.city}}.</label>
		</address>

		<div class="dynamic-template person-record" data-dynamic-template-for="persons.@">
			<label title="{{.first-name}} {{.last-name}}">Identification: {{.id}}.</label>
			<label>First name:     {{.first-name}}.</label>
			<label>Last name:      {{.last-name}}.</label>
			<label>Birth date:     {{.birth-date}}.</label>

			<!-- value based templates -->
			<label>Salary:     	   â‚¬ {{ .per_annum= }} 
				<span class='dynamic-template fte-fulltime-text-full' data-dynamic-template-for=.fte data-dynamic-template-options="range=[0.9,1]">(fulltime, </span>
				<span class='dynamic-template fte-fulltime-text-part' data-dynamic-template-for=.fte data-dynamic-template-options="range=[0.25,0.9>">(parttime, </span>
				<span class='dynamic-template fte-fulltime-text-other' data-dynamic-template-for=.fte data-dynamic-template-options="range=[0,0.25>">(</span>
				<span class='dynamic-template fte-fulltime' data-dynamic-template-for=.fte>{{..fte-perc= ..fte * 100}}%)</span>
			</label>
			<address class="dynamic-template address" data-dynamic-template-for="persons.@.address"></address>
		</div>

		<hr>

		<!-- addition to the company template above, only the children of this DIV are added -->
		<div class="dynamic-template company" data-dynamic-template-options="only-content">
			<address class="dynamic-template address" data-dynamic-template-for=".address"></address>
			<hr>
		</div>

		<table class="dynamic-template person-grid" data-dynamic-template-for="persons">
			<thead>
				<tr>
					<th>ID
					<th>Last
					<th>First
					<th>City
					<th>Salary base
					<th>FTE
					<th>Monthly salary 
					<th>Annual
					<th>Notes
					<th>
				</tr>
				<tr>
					<td colspan=2>Totals
					<td colspan=2>{{persons.$count}} rows
					<td colspan=2>
					<td>{{totals.salary= Sum(persons.*.salary) }}
					<td>{{totals.per_annum= Sum(persons.*.per_annum) }}
					<td colspan=2>
				</tr>
			<tfoot>
				<tr>
					<td colspan=2>Totals
					<td colspan=2>{{persons.$count}} rows
					<td colspan=2>
					<td>{{totals.salary= Sum(persons.*.salary) }}
					<td>{{totals.per_annum= Sum(persons.*.per_annum) }}
					<td colspan=2>
				</tr>
			<tbody>
				<tr class="dynamic-template person-grid-row" data-dynamic-template-for-each="persons">
					<td class=person-id>{{.id}}
					<td>{{.last-name}}
					<td>{{.first-name}}
					<td>{{.address.city}}
					<td><input name=".salary_month" type=number min=0>
					<td><select name=..fte class="dynamic-template fte-select" data-dynamic-template-for='.id'></select>
					<td>{{.salary= .salary_month * .fte}}
					<td>{{.per_annum= .salary * 12 * 1.08}}
					<td><input name=.description>
					<td>
						<button class="remove dynamic-value"></button>
						<button class="move-up dynamic-value"></button>
						<button class="move-down dynamic-value"></button>
				</tr>
		</table>
		
	</body>
</html>
